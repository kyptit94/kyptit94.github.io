(function(){"use strict";var e={9376:function(e,n,t){var a=t(3751),o=t(641),s=t(33);const i={class:".equal-height-cards"};function r(e,n,t,a,r,l){const c=(0,o.g2)("n-button"),u=(0,o.g2)("n-space"),g=(0,o.g2)("n-card"),d=(0,o.g2)("n-input"),f=(0,o.g2)("n-image"),p=(0,o.g2)("n-text"),m=(0,o.g2)("n-data-table");return(0,o.uX)(),(0,o.Wv)(u,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(g,{title:"Thao tác"},{default:(0,o.k6)((()=>[(0,o.bF)(u,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(g,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(c,{type:"primary",onClick:l.loginWithFacebook},{default:(0,o.k6)((()=>n[2]||(n[2]=[(0,o.eW)("Đăng nhập Facebook")]))),_:1},8,["onClick"]),r.loginStatus?((0,o.uX)(),(0,o.Wv)(c,{key:0,type:"primary",onClick:l.getListPages},{default:(0,o.k6)((()=>n[3]||(n[3]=[(0,o.eW)("Lấy danh sách trang")]))),_:1},8,["onClick"])):(0,o.Q3)("",!0)])),_:1})])),_:1}),(0,o.Lk)("div",i,[(0,o.bF)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(g,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(d,{value:r.img,"onUpdate:value":n[0]||(n[0]=e=>r.img=e),type:"text",placeholder:"Link ảnh"},null,8,["value"]),(0,o.bF)(d,{value:r.message,"onUpdate:value":n[1]||(n[1]=e=>r.message=e),type:"textarea",placeholder:"Nội dung tin nhắn"},null,8,["value"])])),_:1})])),_:1}),(0,o.bF)(g,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(f,{width:"300",src:r.img},null,8,["src"]),(0,o.bF)(p,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(r.message),1)])),_:1})])),_:1})])),_:1})])),_:1})])])),_:1})])),_:1}),(0,o.bF)(g,{title:"Danh sách trang"},{default:(0,o.k6)((()=>[(0,o.bF)(m,{columns:r.columns,data:r.pages},null,8,["columns","data"])])),_:1})])),_:1})}var l=t(8220),c=t(9643),u=t(6341),g=t(3940),d=t(498),f=t(5186),p=t(512),m=t(1502),h=t(768),v={name:"App",components:{NButton:l.Ay,NList:c.Ay,NListItem:u.A,NSpace:g.A,NDataTable:d.A,NInput:f.A,NCard:p.Ay,NImage:m.A,NText:h.A},data(){return{user:null,pages:[],message:"",img:"",loginStatus:!1,conversations:[],loadingPages:{},columns:[{title:"Tên trang",key:"name"},{title:"Hành động",key:"actions",render:e=>(0,o.h)(l.Ay,{strong:!0,tertiary:!0,size:"small",loading:this.loadingPages[e.id]||!1,onClick:async()=>{this.loadingPages={...this.loadingPages,[e.id]:!0},await this.getPageConversations(e),this.loadingPages={...this.loadingPages,[e.id]:!1}}},{default:()=>"Gửi"})}]}},methods:{loadFacebookSDK(){return new Promise((e=>{document.getElementById("facebook-jssdk")?e():(window.fbAsyncInit=function(){FB.init({appId:"862815729320540",cookie:!0,xfbml:!0,version:"v12.0"}),e()},function(e,n,t){var a,o=e.getElementsByTagName(n)[0];e.getElementById(t)||(a=e.createElement(n),a.id=t,a.src="https://connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(a,o))}(document,"script","facebook-jssdk"))}))},async loginWithFacebook(){await this.loadFacebookSDK(),FB.login((e=>{e.authResponse?(console.log("Welcome! Fetching your information.... "),FB.api("/me",{fields:"name,email"},(e=>{this.loginStatus=!0}))):this.loginStatus=!1}),{scope:"public_profile,email,pages_show_list,pages_read_engagement,pages_messaging,pages_messaging_subscriptions"})},async getListPages(){FB.api("/me/accounts","GET",{},(e=>{this.pages=e.data}))},async getPageConversations(e){return new Promise((async n=>{const t=10;let a=`/${e.id}/conversations?limit=${t}`;const o=e.access_token;while(a)await new Promise((e=>{FB.api(a,"GET",{access_token:o},(async n=>{n&&!n.error?(await this.sendMessageToAllConversations(n.data,o),a=n.paging&&n.paging.next?n.paging.next:null,e()):(console.error("Error fetching conversations:",n.error),a=null,e())}))}));n()}))},async sendMessageToAllConversations(e,n){const t=n;for(const a of e)await new Promise((e=>{FB.api(`/${a.id}/messages`,"POST",{message:{text:this.message},access_token:n},(n=>{n&&!n.error?console.log(`Text message sent to conversation ${a.id}`):console.error(`Error sending text message to conversation ${a.id}:`,n.error),e()}))})),await new Promise((e=>{console.log(`Sending photo to conversation ${a.id}...`),e(),FB.api(`/${a.id}/messages`,"POST",{message:{attachment:{type:"image",payload:{url:this.img,is_reusable:!0}}},access_token:t},(n=>{n&&!n.error?console.log(`Message sent to conversation ${a.id}`):console.error(`Error sending message to conversation ${a.id}:`,n.error),e()}))}))}}},b=t(6262);const k=(0,b.A)(v,[["render",r]]);var y=k;(0,a.Ef)(y).mount("#app")}},n={};function t(a){var o=n[a];if(void 0!==o)return o.exports;var s=n[a]={exports:{}};return e[a](s,s.exports,t),s.exports}t.m=e,function(){var e=[];t.O=function(n,a,o,s){if(!a){var i=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],s=e[u][2];for(var r=!0,l=0;l<a.length;l++)(!1&s||i>=s)&&Object.keys(t.O).every((function(e){return t.O[e](a[l])}))?a.splice(l--,1):(r=!1,s<i&&(i=s));if(r){e.splice(u--,1);var c=o();void 0!==c&&(n=c)}}return n}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[a,o,s]}}(),function(){t.d=function(e,n){for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={524:0};t.O.j=function(n){return 0===e[n]};var n=function(n,a){var o,s,i=a[0],r=a[1],l=a[2],c=0;if(i.some((function(n){return 0!==e[n]}))){for(o in r)t.o(r,o)&&(t.m[o]=r[o]);if(l)var u=l(t)}for(n&&n(a);c<i.length;c++)s=i[c],t.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return t.O(u)},a=self["webpackChunktool"]=self["webpackChunktool"]||[];a.forEach(n.bind(null,0)),a.push=n.bind(null,a.push.bind(a))}();var a=t.O(void 0,[504],(function(){return t(9376)}));a=t.O(a)})();
//# sourceMappingURL=app.67afdc5d.js.map