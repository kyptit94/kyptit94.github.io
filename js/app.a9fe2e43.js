(function(){"use strict";var e={3033:function(e,n,t){var a=t(3751),o=t(641);function s(e,n,t,a,s,i){const r=(0,o.g2)("Tool"),l=(0,o.g2)("n-dialog-provider"),c=(0,o.g2)("n-modal-provider"),g=(0,o.g2)("n-notification-provider"),u=(0,o.g2)("n-message-provider"),d=(0,o.g2)("n-loading-bar-provider");return(0,o.uX)(),(0,o.Wv)(d,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(g,null,{default:(0,o.k6)((()=>[(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.bF)(l,null,{default:(0,o.k6)((()=>[(0,o.bF)(r)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}var i=t(33);function r(e,n,t,a,s,r){const l=(0,o.g2)("n-button"),c=(0,o.g2)("n-space"),g=(0,o.g2)("n-card"),u=(0,o.g2)("n-upload"),d=(0,o.g2)("n-input"),p=(0,o.g2)("n-data-table");return(0,o.uX)(),(0,o.Wv)(c,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(g,{title:"Gửi tin nhắn FB Version 1.2.6"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(g,null,{default:(0,o.k6)((()=>[(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.bF)(l,{type:"primary",onClick:r.loginWithFacebook},{default:(0,o.k6)((()=>n[1]||(n[1]=[(0,o.eW)("Đăng nhập Facebook")]))),_:1},8,["onClick"]),s.loginStatus?((0,o.uX)(),(0,o.Wv)(l,{key:0,type:"primary",onClick:r.getListPages},{default:(0,o.k6)((()=>n[2]||(n[2]=[(0,o.eW)("Lấy danh sách trang")]))),_:1},8,["onClick"])):(0,o.Q3)("",!0)])),_:1})])),_:1}),(0,o.bF)(g,null,{default:(0,o.k6)((()=>[(0,o.bF)(c,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(u,{"on-update:file-list":a.UpdateFile,"list-type":"image-card"},{default:(0,o.k6)((()=>n[3]||(n[3]=[(0,o.eW)(" Tải ảnh lên ")]))),_:1},8,["on-update:file-list"]),(0,o.bF)(d,{autosize:"",value:s.message,"onUpdate:value":n[0]||(n[0]=e=>s.message=e),type:"textarea",placeholder:"Nội dung tin nhắn"},null,8,["value"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.bF)(g,{title:"Danh sách trang"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{style:{float:"right"}},{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(s.count),1)])),_:1}),(0,o.bF)(p,{columns:s.columns,data:s.pages},null,8,["columns","data"])])),_:1})])),_:1})}var l=t(4),c=t(9643),g=t(6341),u=t(5587),d=t(565),p=t(9082),f=t(304),m=t(4984),h=t(2009),v=t(4382),y=t(9320),b=t(953),_=t(223),k=t(5904);const F={apiKey:"AIzaSyB3-qhi7iQKjNMiPW7BxDB7qq3nCZ6EyIg",authDomain:"sendmessage-77d09.firebaseapp.com",projectId:"sendmessage-77d09",storageBucket:"sendmessage-77d09.appspot.com",messagingSenderId:"244801679333",appId:"1:244801679333:web:17f9ab0930e8693dbdc90c",measurementId:"G-H6XEVYSJVT"},w=(0,_.Wp)(F),A=(0,k.c7)(w);var P={name:"App",components:{NButton:l.Ay,NList:c.Ay,NListItem:g.A,NSpace:u.A,NDataTable:d.A,NInput:p.A,NCard:f.Ay,NImage:m.A,NText:h.A},setup(){(0,v.J)();const e=(0,y.h)(),n=(0,b.KR)(null),t=(0,b.KR)(""),a=async()=>new Promise((async e=>{if(!n.value)return void alert("Please select a file first.");const a=(0,k.KR)(A,"/images/guitinnhan.png");try{await(0,k.D)(a,n.value);const e=await(0,k.qk)(a);t.value=e,console.log("File available at",e)}catch(o){console.error("Error uploading file:",o)}e(t.value)}));return{notify(n){e.create({title:"Gửi tin nhắn",content:n,type:"success"})},async UpdateFile(e){e.length>0&&e[0].file?n.value=e[0].file:n.value=null},file:n,imageUrl:t,uploadImage:a}},data(){return{user:null,pages:[],message:"",img:"",count:0,loginStatus:!1,conversations:[],loadingPages:{},columns:[{title:"Tên trang",key:"name"},{title:"Hành động",key:"actions",render:e=>(0,o.h)(l.Ay,{strong:!0,tertiary:!0,size:"small",loading:this.loadingPages[e.id]||!1,onClick:async()=>{this.loadingPages={...this.loadingPages,[e.id]:!0},await this.getPageConversations(e),this.loadingPages={...this.loadingPages,[e.id]:!1}}},{default:()=>"Gửi"})}]}},methods:{async testUpload(){console.log(await this.uploadImage())},loadFacebookSDK(){return new Promise((e=>{document.getElementById("facebook-jssdk")?e():(window.fbAsyncInit=function(){FB.init({appId:"862815729320540",cookie:!0,xfbml:!0,version:"v12.0"}),e()},function(e,n,t){var a,o=e.getElementsByTagName(n)[0];e.getElementById(t)||(a=e.createElement(n),a.id=t,a.src="https://connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(a,o))}(document,"script","facebook-jssdk"))}))},async loginWithFacebook(){await this.loadFacebookSDK(),FB.login((e=>{e.authResponse?(console.log("Welcome! Fetching your information.... "),FB.api("/me",{fields:"name,email"},(e=>{this.loginStatus=!0}))):this.loginStatus=!1}),{scope:"pages_show_list, pages_messaging, ads_management, ads_read, business_management, leads_retrieval, page_events, pages_read_engagement, pages_manage_metadata, pages_read_user_content, pages_manage_ads, pages_manage_posts, pages_manage_engagement"})},async getListPages(){FB.api("/me/accounts?limit=200","GET",{},(e=>{this.pages=e.data}))},formatMessage(e){let n=e;const t=n.match(/{(.*?)}/g)||[];if(t.length>0){let e=t[0],a=e.split("|"),o=0;return t.forEach((()=>{let t=a[o].replace("{","").replace("}","");n=n.replace(e,t),o==a.length-1?o=0:o++})),n}return n},async getPageConversations(e){return this.count=0,await this.uploadImage(),new Promise((async n=>{try{const t=100;let a=`/${e.id}/conversations?limit=${t}&`;const o=e.access_token,s="id,participants";while(a)await new Promise((n=>{FB.api(a,"GET",{access_token:o,fields:s},(async t=>{if(t&&!t.error){let s=t.data.map((n=>n.participants.data.find((n=>n.id!==e.id))));for(const n of s)n&&n.id&&(this.count++,await this.sendMessageToAllConversations(e.id,n.id,o));a=t.paging&&t.paging.next?t.paging.next:null,n()}else console.error("Error fetching conversations:",t.error),a=null,n()}))}));this.notify("Đã gửi tin nhắn cho tất cả người dùng"),n()}catch(t){console.error("Error fetching conversations:",t),n()}}))},async sendMessageToAllConversations(e,n,t){const a=t;await new Promise((a=>{FB.api(`/${e}/messages`,"POST",{message:{text:this.formatMessage(this.message)},messaging_type:"MESSAGE_TAG",tag:"ACCOUNT_UPDATE",recipient:{id:n},access_token:t},(e=>{e&&!e.error?console.log(`Text message sent to conversation ${n}`):console.error(`Error sending text message to conversation ${n}:`,e.error),a()}))})),this.imageUrl&&await new Promise((t=>{console.log(`Sending photo to conversation ${n}...`),t(),FB.api(`/${e}/messages`,"POST",{message:{attachment:{type:"image",payload:{url:this.imageUrl,is_reusable:!0}}},messaging_type:"MESSAGE_TAG",tag:"ACCOUNT_UPDATE",recipient:{id:n},access_token:a},(e=>{e&&!e.error?console.log(`Message sent to conversation ${n}`):console.error(`Error sending message to conversation ${n}:`,e.error),t()}))}))}}},T=t(6262);const S=(0,T.A)(P,[["render",r]]);var E=S,B=(0,o.pM)({components:{Tool:E}});const C=(0,T.A)(B,[["render",s]]);var O=C,I=t(9519);const N=(0,a.Ef)(O);N.use(I.A),N.mount("#app")}},n={};function t(a){var o=n[a];if(void 0!==o)return o.exports;var s=n[a]={exports:{}};return e[a](s,s.exports,t),s.exports}t.m=e,function(){var e=[];t.O=function(n,a,o,s){if(!a){var i=1/0;for(g=0;g<e.length;g++){a=e[g][0],o=e[g][1],s=e[g][2];for(var r=!0,l=0;l<a.length;l++)(!1&s||i>=s)&&Object.keys(t.O).every((function(e){return t.O[e](a[l])}))?a.splice(l--,1):(r=!1,s<i&&(i=s));if(r){e.splice(g--,1);var c=o();void 0!==c&&(n=c)}}return n}s=s||0;for(var g=e.length;g>0&&e[g-1][2]>s;g--)e[g]=e[g-1];e[g]=[a,o,s]}}(),function(){t.d=function(e,n){for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};t.O.j=function(n){return 0===e[n]};var n=function(n,a){var o,s,i=a[0],r=a[1],l=a[2],c=0;if(i.some((function(n){return 0!==e[n]}))){for(o in r)t.o(r,o)&&(t.m[o]=r[o]);if(l)var g=l(t)}for(n&&n(a);c<i.length;c++)s=i[c],t.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return t.O(g)},a=self["webpackChunktool"]=self["webpackChunktool"]||[];a.forEach(n.bind(null,0)),a.push=n.bind(null,a.push.bind(a))}();var a=t.O(void 0,[504],(function(){return t(3033)}));a=t.O(a)})();
//# sourceMappingURL=app.a9fe2e43.js.map