(function(){"use strict";var e={9493:function(e,t,n){var a=n(3751),o=n(641);function s(e,t,n,a,s,r){const i=(0,o.g2)("Tool"),l=(0,o.g2)("n-dialog-provider"),c=(0,o.g2)("n-modal-provider"),u=(0,o.g2)("n-notification-provider"),g=(0,o.g2)("n-message-provider"),d=(0,o.g2)("n-loading-bar-provider");return(0,o.uX)(),(0,o.Wv)(d,null,{default:(0,o.k6)((()=>[(0,o.bF)(g,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.bF)(l,null,{default:(0,o.k6)((()=>[(0,o.bF)(i)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}var r=n(33);function i(e,t,n,a,s,i){const l=(0,o.g2)("n-button"),c=(0,o.g2)("n-space"),u=(0,o.g2)("n-card"),g=(0,o.g2)("n-upload"),d=(0,o.g2)("n-input"),p=(0,o.g2)("n-data-table"),h=(0,o.g2)("n-gi"),m=(0,o.g2)("n-grid");return(0,o.uX)(),(0,o.Wv)(c,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(u,{title:"Gửi tin nhắn FB Version 1.4.3"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.bF)(l,{type:"primary",onClick:i.loginWithFacebook},{default:(0,o.k6)((()=>t[1]||(t[1]=[(0,o.eW)("Đăng nhập Facebook")]))),_:1},8,["onClick"]),s.loginStatus?((0,o.uX)(),(0,o.Wv)(l,{key:0,type:"primary",onClick:i.getListPages},{default:(0,o.k6)((()=>t[2]||(t[2]=[(0,o.eW)("Lấy danh sách trang")]))),_:1},8,["onClick"])):(0,o.Q3)("",!0)])),_:1})])),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(c,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(g,{"on-update:file-list":a.UpdateFile,"list-type":"image-card"},{default:(0,o.k6)((()=>t[3]||(t[3]=[(0,o.eW)(" Tải ảnh lên ")]))),_:1},8,["on-update:file-list"]),(0,o.bF)(d,{autosize:"",value:s.message,"onUpdate:value":t[0]||(t[0]=e=>s.message=e),type:"textarea",placeholder:"Nội dung tin nhắn"},null,8,["value"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.bF)(m,{"x-gap":"12",cols:2},{default:(0,o.k6)((()=>[(0,o.bF)(h,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,{title:"Danh sách trang"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{style:{float:"right"}},{default:(0,o.k6)((()=>[(0,o.eW)((0,r.v_)(s.count),1)])),_:1}),(0,o.bF)(p,{columns:s.columns,data:s.pages},null,8,["columns","data"])])),_:1})])),_:1}),(0,o.bF)(h,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,{title:"Kết quả nhắn tin"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{placeholder:"Tìm kiếm",onChange:i.searchUser},null,8,["onChange"]),(0,o.bF)(p,{columns:s.columnsResult,pagination:{pageSize:10},data:s.dataResult},null,8,["columns","data"])])),_:1})])),_:1})])),_:1})])),_:1})}n(4114);var l=n(4),c=n(9643),u=n(6341),g=n(5587),d=n(565),p=n(9082),h=n(304),m=n(4984),f=n(2009),y=n(4382),k=n(9320),v=n(953),_=n(4335),b=n(223),w=n(5904);const F={apiKey:"AIzaSyB3-qhi7iQKjNMiPW7BxDB7qq3nCZ6EyIg",authDomain:"sendmessage-77d09.firebaseapp.com",projectId:"sendmessage-77d09",storageBucket:"sendmessage-77d09.appspot.com",messagingSenderId:"244801679333",appId:"1:244801679333:web:17f9ab0930e8693dbdc90c",measurementId:"G-H6XEVYSJVT"},T="v21.0",A="862815729320540",C=(0,b.Wp)(F),P=(0,w.c7)(C);var E={name:"App",components:{NButton:l.Ay,NList:c.Ay,NListItem:u.A,NSpace:g.A,NDataTable:d.A,NInput:p.A,NCard:h.Ay,NImage:m.A,NText:f.A},setup(){(0,y.J)();const e=(0,k.h)(),t=(0,v.KR)(null),n=(0,v.KR)(""),a=async()=>new Promise((async e=>{if(!t.value)return void alert("Please select a file first.");const a=(0,w.KR)(P,"/images/guitinnhan.png");try{await(0,w.D)(a,t.value);const e=await(0,w.qk)(a);n.value=e,console.log("File available at",e)}catch(o){console.error("Error uploading file:",o)}e(n.value)}));return{notify(t){e.create({title:"Gửi tin nhắn",content:t,type:"success",duration:1e3})},async UpdateFile(e){e.length>0&&e[0].file?t.value=e[0].file:t.value=null},file:t,imageUrl:n,uploadImage:a}},data(){return{user:null,pages:[],dataResult:[],message:"",img:"",original:{},count:0,loginStatus:!1,conversations:[],loadingPages:{},columns:[{title:"Tên trang",key:"name"},{title:"Hành động",key:"actions",render:e=>(0,o.h)(g.A,{},{default:()=>[(0,o.h)(l.Ay,{strong:!0,tertiary:!0,size:"small",loading:this.loadingPages[e.id]||!1,onClick:async()=>{this.loadingPages={...this.loadingPages,[e.id]:!0},await this.getPageConversations(e),this.loadingPages={...this.loadingPages,[e.id]:!1}}},{default:()=>"Gửi"}),(0,o.h)(l.Ay,{strong:!0,tertiary:!0,size:"small",onClick:()=>{this.getCurrentInfo(e.id)}},{default:()=>"Xem"})]})}],columnsResult:[{title:"Tên người nhận",key:"name"},{title:"Trạng thái",key:"status"},{title:"note",key:"note"}]}},methods:{getCurrentInfo(e){this.dataResult=this.original[e]},searchUser(e){let t=[...this.dataResult];this.dataResult=e?t.filter((t=>t.name.toLowerCase().includes(e.toLowerCase()))):t},async testUpload(){console.log(await this.uploadImage())},loadFacebookSDK(){return new Promise((e=>{document.getElementById("facebook-jssdk")?e():(window.fbAsyncInit=function(){FB.init({appId:A,cookie:!0,xfbml:!0,version:T}),e()},function(e,t,n){var a,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(a=e.createElement(t),a.id=n,a.src="https://connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(a,o))}(document,"script","facebook-jssdk"))}))},async requestThreadControl(e,t,n,a){return new Promise((async o=>{const s=`https://graph.facebook.com/${T}/${e}/pass_thread_control`,r={recipient:{id:t},metadata:n};try{const e=await _.A.post(s,r,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});console.log("Thread control passed successfully:",e.data)}catch(i){console.error("Error passing thread control:",i)}o()}))},async takeThreadControl(e,t,n){return new Promise((async a=>{const o=`https://graph.facebook.com/${T}/${e}/take_thread_control`,s={recipient:{id:e},sender:{id:t},take_thread_control:{previous_owner_app_id:null,new_owner_app_id:A,metadata:"additional content that the caller wants to set"}};try{const e=await _.A.post(o,s,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});console.log("Thread control taken successfully:",e.data)}catch(r){console.error("Error taking thread control:",r)}a()}))},async getCurrentAppUsingThreadControl(e,t,n){return new Promise((async a=>{const o=`https://graph.facebook.com/${T}/${e}/thread_owner`;try{const e=await _.A.get(o,{params:{recipient:t}},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});console.log("Current app using thread control:",e.data),a(e.data.data)}catch(s){console.error("Error getting current app using thread control:",s),a(null)}}))},async loginWithFacebook(){await this.loadFacebookSDK(),FB.login((e=>{e.authResponse?(console.log("Welcome! Fetching your information.... "),FB.api("/me",{fields:"name,email"},(e=>{this.loginStatus=!0}))):this.loginStatus=!1}),{scope:"pages_show_list, pages_messaging, page_events, pages_read_engagement, pages_manage_metadata, pages_read_user_content, pages_manage_posts, pages_manage_engagement"})},async getListPages(){FB.api("/me/accounts?limit=200","GET",{},(e=>{this.pages=e.data}))},formatMessage(e){let t=e;const n=t.match(/{(.*?)}/g)||[];if(n.length>0){let e=n[0],a=e.split("|"),o=0;return n.forEach((()=>{let n=a[o].replace("{","").replace("}","");t=t.replace(e,n),o==a.length-1?o=0:o++})),t}return t},async getPageConversations(e){return this.count=0,await this.uploadImage(),new Promise((async t=>{try{const n=100;let a=`/${e.id}/conversations?limit=${n}&`;const o=e.access_token,s="id,participants";while(a)await new Promise((t=>{FB.api(a,"GET",{access_token:o,fields:s},(async n=>{if(n&&!n.error){let s=n.data.map((t=>t.participants.data.find((t=>t.id!==e.id))));for(const t of s)t&&t.id&&(this.count++,await this.sendMessageToAllConversations(e.id,t.id,t.name,o));a=n.paging&&n.paging.next?n.paging.next:null,t()}else console.error("Error fetching conversations:",n.error),a=null,t()}))}));this.notify("Đã gửi tin nhắn cho tất cả người dùng"),t()}catch(n){console.error("Error fetching conversations:",n),t()}}))},async releaseThreadControl(e,t,n){return new Promise((async a=>{const o=`https://graph.facebook.com/${T}/${e}/pass_thread_control`,s={recipient:t};try{const e=await _.A.post(o,s,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});console.log("Thread control passed successfully:",e.data)}catch(r){console.error("Error passing thread control:",r)}a()}))},async sendMessageToAllConversations(e,t,n,a){const o=a;await this.takeThreadControl(e,t,a),await new Promise((e=>{setTimeout((()=>{e(),console.log("Waiting 600ms...")}),800)}));let s=await new Promise((o=>{FB.api(`/${e}/messages`,"POST",{message:{text:this.formatMessage(this.message)},messaging_type:"MESSAGE_TAG",tag:"ACCOUNT_UPDATE",recipient:{id:t},access_token:a},(e=>{e&&!e.error?(o({name:n,status:"Đã gửi",note:""}),console.log(`Message sent to conversation ${t}`)):(console.error(`Error sending message to conversation ${t}:`,e.error),o({name:n,status:"Lỗi",note:e.error.message}))}))}));this.original[e].push(s),this.imageUrl&&await new Promise((n=>{console.log(`Sending photo to conversation ${t}...`),n(),FB.api(`/${e}/messages`,"POST",{message:{attachment:{type:"image",payload:{url:this.imageUrl,is_reusable:!0}}},messaging_type:"MESSAGE_TAG",tag:"ACCOUNT_UPDATE",recipient:{id:t},access_token:o},(e=>{e&&!e.error?console.log(`Message sent to conversation ${t}`):console.error(`Error sending message to conversation ${t}:`,e.error),n()}))}))}}},S=n(6262);const B=(0,S.A)(E,[["render",i]]);var $=B,I=(0,o.pM)({components:{Tool:$}});const j=(0,S.A)(I,[["render",s]]);var O=j,N=n(4757);const U=(0,a.Ef)(O);U.use(N.A),U.mount("#app")}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a].call(s.exports,s,s.exports,n),s.exports}n.m=e,function(){var e=[];n.O=function(t,a,o,s){if(!a){var r=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],s=e[u][2];for(var i=!0,l=0;l<a.length;l++)(!1&s||r>=s)&&Object.keys(n.O).every((function(e){return n.O[e](a[l])}))?a.splice(l--,1):(i=!1,s<r&&(r=s));if(i){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[a,o,s]}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,s,r=a[0],i=a[1],l=a[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(l)var u=l(n)}for(t&&t(a);c<r.length;c++)s=r[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(u)},a=self["webpackChunktool"]=self["webpackChunktool"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[504],(function(){return n(9493)}));a=n.O(a)})();
//# sourceMappingURL=app.4543563c.js.map