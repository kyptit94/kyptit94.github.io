(function(){"use strict";var e={7362:function(e,t,n){var a=n(3751),o=n(641);function i(e,t,n,a,i,s){const r=(0,o.g2)("Tool"),l=(0,o.g2)("n-dialog-provider"),c=(0,o.g2)("n-modal-provider"),u=(0,o.g2)("n-notification-provider"),g=(0,o.g2)("n-message-provider"),d=(0,o.g2)("n-loading-bar-provider");return(0,o.uX)(),(0,o.Wv)(d,null,{default:(0,o.k6)((()=>[(0,o.bF)(g,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.bF)(l,null,{default:(0,o.k6)((()=>[(0,o.bF)(r)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}var s=n(33);const r={class:".equal-height-cards"};function l(e,t,n,a,i,l){const c=(0,o.g2)("n-button"),u=(0,o.g2)("n-space"),g=(0,o.g2)("n-card"),d=(0,o.g2)("n-upload"),f=(0,o.g2)("n-form-item"),p=(0,o.g2)("n-input"),m=(0,o.g2)("n-data-table");return(0,o.uX)(),(0,o.Wv)(u,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(g,{title:"Gửi tin nhắn FB Version 1.1.8"},{default:(0,o.k6)((()=>[(0,o.bF)(u,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(g,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(c,{type:"primary",onClick:l.loginWithFacebook},{default:(0,o.k6)((()=>t[1]||(t[1]=[(0,o.eW)("Đăng nhập Facebook")]))),_:1},8,["onClick"]),i.loginStatus?((0,o.uX)(),(0,o.Wv)(c,{key:0,type:"primary",onClick:l.getListPages},{default:(0,o.k6)((()=>t[2]||(t[2]=[(0,o.eW)("Lấy danh sách trang")]))),_:1},8,["onClick"])):(0,o.Q3)("",!0)])),_:1})])),_:1}),(0,o.Lk)("div",r,[(0,o.bF)(g,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,{vertical:""},{default:(0,o.k6)((()=>[(0,o.bF)(f,{label:"Tải lên",path:"uploadValue"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{"default-file-list":a.fileList,"list-type":"image-card","response-type":"blob","on-update:file-list":l.updateFileList,onPreview:a.handlePreview},{default:(0,o.k6)((()=>[(0,o.bF)(c,null,{default:(0,o.k6)((()=>t[3]||(t[3]=[(0,o.eW)("Ảnh")]))),_:1})])),_:1},8,["default-file-list","on-update:file-list","onPreview"])])),_:1}),(0,o.bF)(p,{value:i.message,"onUpdate:value":t[0]||(t[0]=e=>i.message=e),autosize:"{ minRows: 3, maxRows: 5 }",type:"textarea",placeholder:"Nội dung tin nhắn"},null,8,["value"])])),_:1})])),_:1})])])),_:1})])),_:1}),(0,o.bF)(g,{title:"Danh sách trang"},{default:(0,o.k6)((()=>[(0,o.bF)(c,{style:{float:"right"}},{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(i.count),1)])),_:1}),(0,o.bF)(m,{columns:i.columns,data:i.pages},null,8,["columns","data"])])),_:1})])),_:1})}var c=n(4),u=n(9643),g=n(6341),d=n(5587),f=n(565),p=n(9082),m=n(304),h=n(4984),v=n(2009),b=n(8460),y=n(4382),k=n(9320),_=n(953),F={name:"App",components:{NButton:c.Ay,NList:u.Ay,NListItem:g.A,NSpace:d.A,NDataTable:f.A,NInput:p.A,NCard:m.Ay,NImage:h.A,NText:v.A,NFormItem:b.Ay},setup(){(0,y.J)();const e=(0,k.h)(),t=(0,_.KR)("");function n(e){console.log(e);const{url:n}=e;t.value=n}return{notify(t){e.create({title:"Gửi tin nhắn",content:t,type:"success"})},handlePreview:n,previewImageUrl:t,fileList:(0,_.KR)([])}},data(){return{user:null,pages:[],message:"",imgPreview:"",img:"",listUpload:[],count:0,loginStatus:!1,conversations:[],loadingPages:{},columns:[{title:"Tên trang",key:"name"},{title:"Hành động",key:"actions",render:e=>(0,o.h)(c.Ay,{strong:!0,tertiary:!0,size:"small",loading:this.loadingPages[e.id]||!1,onClick:async()=>{this.loadingPages={...this.loadingPages,[e.id]:!0},await this.getPageConversations(e),this.loadingPages={...this.loadingPages,[e.id]:!1}}},{default:()=>"Gửi"})}]}},methods:{updateFileList(e){this.listUpload=e},loadFacebookSDK(){return new Promise((e=>{document.getElementById("facebook-jssdk")?e():(window.fbAsyncInit=function(){FB.init({appId:"862815729320540",cookie:!0,xfbml:!0,version:"v12.0"}),e()},function(e,t,n){var a,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(a=e.createElement(t),a.id=n,a.src="https://connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(a,o))}(document,"script","facebook-jssdk"))}))},async loginWithFacebook(){await this.loadFacebookSDK(),FB.login((e=>{e.authResponse?(console.log("Welcome! Fetching your information.... "),FB.api("/me",{fields:"name,email"},(e=>{this.loginStatus=!0}))):this.loginStatus=!1}),{scope:"public_profile,email,pages_show_list,pages_read_engagement,pages_messaging,pages_messaging_subscriptions,pages_manage_metadata"})},async getListPages(){FB.api("/me/accounts","GET",{},(e=>{this.pages=e.data}))},formatMessage(e){let t=e;const n=t.match(/{(.*?)}/g)||[];if(n.length>0){let e=n[0],a=e.split("|"),o=0;return n.forEach((()=>{let n=a[o].replace("{","").replace("}","");t=t.replace(e,n),o==a.length-1?o=0:o++})),t}return t},async getPageConversations(e){return this.count=0,new Promise((async t=>{try{const n=100;let a=`/${e.id}/conversations?limit=${n}&`;const o=e.access_token,i="id,participants";while(a)await new Promise((t=>{FB.api(a,"GET",{access_token:o,fields:i},(async n=>{if(n&&!n.error){let i=n.data.map((t=>t.participants.data.find((t=>t.id!==e.id))));for(const t of i)t&&t.id&&(this.count++,await this.sendMessageToAllConversations(e.id,t.id,o));a=n.paging&&n.paging.next?n.paging.next:null,t()}else console.error("Error fetching conversations:",n.error),a=null,t()}))}));this.notify("Đã gửi tin nhắn cho tất cả người dùng"),t()}catch(n){console.error("Error fetching conversations:",n),t()}}))},async convertFileToBase64(e){return new Promise((t=>{const n=new FileReader;n.onload=e=>{t(e.target.result)},n.readAsDataURL(e)}))},async SendImageToConservation(e,t,n,a){FB.api(`/${t}/messages`,"POST",{message:{attachment:{type:"image",payload:{is_reusable:!0,url:await this.convertFileToBase64(e)}}},messaging_type:"MESSAGE_TAG",tag:"ACCOUNT_UPDATE",recipient:{id:n},access_token:pageAccessToken},(e=>{e&&!e.error?console.log(`Message sent to conversation ${n}`):console.error(`Error sending message to conversation ${n}:`,e.error),resolve()}))},async sendMessageToAllConversations(e,t,n){await new Promise((a=>{FB.api(`/${e}/messages`,"POST",{message:{text:this.formatMessage(this.message)},messaging_type:"MESSAGE_TAG",tag:"ACCOUNT_UPDATE",recipient:{id:t},access_token:n},(e=>{e&&!e.error?console.log(`Text message sent to conversation ${t}`):console.error(`Error sending text message to conversation ${t}:`,e.error),a()}))})),this.listUpload&&this.listUpload.length>0&&await new Promise((async a=>{for(const o of this.listUpload)await this.SendImageToConservation(o.file,e,t,n);a()}))}}},w=n(6262);const P=(0,w.A)(F,[["render",l]]);var T=P,A=(0,o.pM)({components:{Tool:T}});const S=(0,w.A)(A,[["render",i]]);var E=S,C=n(2875);const O=(0,a.Ef)(E);O.use(C.A),O.mount("#app")}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,a,o,i){if(!a){var s=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],i=e[u][2];for(var r=!0,l=0;l<a.length;l++)(!1&i||s>=i)&&Object.keys(n.O).every((function(e){return n.O[e](a[l])}))?a.splice(l--,1):(r=!1,i<s&&(s=i));if(r){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[a,o,i]}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,i,s=a[0],r=a[1],l=a[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(l)var u=l(n)}for(t&&t(a);c<s.length;c++)i=s[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(u)},a=self["webpackChunktool"]=self["webpackChunktool"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[504],(function(){return n(7362)}));a=n.O(a)})();
//# sourceMappingURL=app.17867940.js.map