(function(){"use strict";var e={750:function(e,n,t){var o=t(3751),a=t(641);function i(e,n,t,o,i,s){const r=(0,a.g2)("Tool"),l=(0,a.g2)("n-dialog-provider"),c=(0,a.g2)("n-modal-provider"),u=(0,a.g2)("n-notification-provider"),g=(0,a.g2)("n-message-provider"),d=(0,a.g2)("n-loading-bar-provider");return(0,a.uX)(),(0,a.Wv)(d,null,{default:(0,a.k6)((()=>[(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(l,null,{default:(0,a.k6)((()=>[(0,a.bF)(r)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}var s=t(33);const r={class:".equal-height-cards"};function l(e,n,t,o,i,l){const c=(0,a.g2)("n-button"),u=(0,a.g2)("n-space"),g=(0,a.g2)("n-card"),d=(0,a.g2)("n-input"),f=(0,a.g2)("n-image"),p=(0,a.g2)("n-text"),m=(0,a.g2)("n-data-table");return(0,a.uX)(),(0,a.Wv)(u,{vertical:""},{default:(0,a.k6)((()=>[(0,a.bF)(g,{title:"Gửi tin nhắn FB Version 1.1.2"},{default:(0,a.k6)((()=>[(0,a.bF)(u,{vertical:""},{default:(0,a.k6)((()=>[(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.bF)(c,{type:"primary",onClick:l.loginWithFacebook},{default:(0,a.k6)((()=>n[2]||(n[2]=[(0,a.eW)("Đăng nhập Facebook")]))),_:1},8,["onClick"]),i.loginStatus?((0,a.uX)(),(0,a.Wv)(c,{key:0,type:"primary",onClick:l.getListPages},{default:(0,a.k6)((()=>n[3]||(n[3]=[(0,a.eW)("Lấy danh sách trang")]))),_:1},8,["onClick"])):(0,a.Q3)("",!0)])),_:1})])),_:1}),(0,a.Lk)("div",r,[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,{vertical:""},{default:(0,a.k6)((()=>[(0,a.bF)(d,{value:i.img,"onUpdate:value":n[0]||(n[0]=e=>i.img=e),type:"text",placeholder:"Link ảnh"},null,8,["value"]),(0,a.bF)(d,{value:i.message,"onUpdate:value":n[1]||(n[1]=e=>i.message=e),type:"textarea",placeholder:"Nội dung tin nhắn"},null,8,["value"])])),_:1})])),_:1}),(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,{vertical:""},{default:(0,a.k6)((()=>[(0,a.bF)(f,{width:"300",src:i.img},null,8,["src"]),(0,a.bF)(p,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,s.v_)(i.message),1)])),_:1})])),_:1})])),_:1})])),_:1})])])),_:1})])),_:1}),(0,a.bF)(g,{title:"Danh sách trang"},{default:(0,a.k6)((()=>[(0,a.bF)(c,{style:{float:"right"}},{default:(0,a.k6)((()=>[(0,a.eW)((0,s.v_)(i.count),1)])),_:1}),(0,a.bF)(m,{columns:i.columns,data:i.pages},null,8,["columns","data"])])),_:1})])),_:1})}var c=t(4),u=t(9643),g=t(6341),d=t(5587),f=t(565),p=t(9082),m=t(304),h=t(4984),v=t(2009),b=t(4382),k=t(9320),y={name:"App",components:{NButton:c.Ay,NList:u.Ay,NListItem:g.A,NSpace:d.A,NDataTable:f.A,NInput:p.A,NCard:m.Ay,NImage:h.A,NText:v.A},setup(){(0,b.J)();const e=(0,k.h)();return{notify(n){e.create({title:"Gửi tin nhắn",content:n,type:"success",duration:2e3})}}},data(){return{user:null,pages:[],message:"",img:"",count:0,loginStatus:!1,conversations:[],loadingPages:{},columns:[{title:"Tên trang",key:"name"},{title:"Hành động",key:"actions",render:e=>(0,a.h)(c.Ay,{strong:!0,tertiary:!0,size:"small",loading:this.loadingPages[e.id]||!1,onClick:async()=>{this.loadingPages={...this.loadingPages,[e.id]:!0},await this.getPageConversations(e),this.loadingPages={...this.loadingPages,[e.id]:!1}}},{default:()=>"Gửi"})}]}},methods:{loadFacebookSDK(){return new Promise((e=>{document.getElementById("facebook-jssdk")?e():(window.fbAsyncInit=function(){FB.init({appId:"862815729320540",cookie:!0,xfbml:!0,version:"v12.0"}),e()},function(e,n,t){var o,a=e.getElementsByTagName(n)[0];e.getElementById(t)||(o=e.createElement(n),o.id=t,o.src="https://connect.facebook.net/en_US/sdk.js",a.parentNode.insertBefore(o,a))}(document,"script","facebook-jssdk"))}))},async loginWithFacebook(){await this.loadFacebookSDK(),FB.login((e=>{e.authResponse?(console.log("Welcome! Fetching your information.... "),FB.api("/me",{fields:"name,email"},(e=>{this.loginStatus=!0}))):this.loginStatus=!1}),{scope:"public_profile,email,pages_show_list,pages_read_engagement,pages_messaging,pages_messaging_subscriptions,pages_manage_metadata"})},async getListPages(){FB.api("/me/accounts","GET",{},(e=>{this.pages=e.data}))},async getPageConversations(e){return this.count=0,new Promise((async n=>{try{const t=100;let o=`/${e.id}/conversations?limit=${t}&`;const a=e.access_token,i="id,participants";while(o)await new Promise((n=>{FB.api(o,"GET",{access_token:a,fields:i},(async t=>{if(t&&!t.error){let i=t.data.map((n=>n.participants.data.find((n=>n.id!==e.id))));for(const n of i)n&&n.id&&(this.count++,await this.sendMessageToAllConversations(e.id,n.id,a));o=t.paging&&t.paging.next?t.paging.next:null,n()}else console.error("Error fetching conversations:",t.error),o=null,n()}))}));n()}catch(t){console.error("Error fetching conversations:",t),n()}}))},async sendMessageToAllConversations(e,n,t){const o=t;await new Promise((o=>{FB.api(`/${e}/messages`,"POST",{message:{text:this.message},messaging_type:"MESSAGE_TAG",tag:"ACCOUNT_UPDATE",recipient:{id:n},access_token:t},(e=>{e&&!e.error?console.log(`Text message sent to conversation ${n}`):console.error(`Error sending text message to conversation ${n}:`,e.error),o()}))})),this.img&&await new Promise((t=>{console.log(`Sending photo to conversation ${n}...`),t(),FB.api(`/${e}/messages`,"POST",{message:{attachment:{type:"image",payload:{url:this.img,is_reusable:!0}}},messaging_type:"MESSAGE_TAG",tag:"ACCOUNT_UPDATE",recipient:{id:n},access_token:o},(e=>{e&&!e.error?console.log(`Message sent to conversation ${n}`):console.error(`Error sending message to conversation ${n}:`,e.error),t()}))}))}}},_=t(6262);const F=(0,_.A)(y,[["render",l]]);var A=F,w=(0,a.pM)({components:{Tool:A}});const P=(0,_.A)(w,[["render",i]]);var T=P,S=t(9519);const E=(0,o.Ef)(T);E.use(S.A),E.mount("#app")}},n={};function t(o){var a=n[o];if(void 0!==a)return a.exports;var i=n[o]={exports:{}};return e[o](i,i.exports,t),i.exports}t.m=e,function(){var e=[];t.O=function(n,o,a,i){if(!o){var s=1/0;for(u=0;u<e.length;u++){o=e[u][0],a=e[u][1],i=e[u][2];for(var r=!0,l=0;l<o.length;l++)(!1&i||s>=i)&&Object.keys(t.O).every((function(e){return t.O[e](o[l])}))?o.splice(l--,1):(r=!1,i<s&&(s=i));if(r){e.splice(u--,1);var c=a();void 0!==c&&(n=c)}}return n}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[o,a,i]}}(),function(){t.d=function(e,n){for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};t.O.j=function(n){return 0===e[n]};var n=function(n,o){var a,i,s=o[0],r=o[1],l=o[2],c=0;if(s.some((function(n){return 0!==e[n]}))){for(a in r)t.o(r,a)&&(t.m[a]=r[a]);if(l)var u=l(t)}for(n&&n(o);c<s.length;c++)i=s[c],t.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return t.O(u)},o=self["webpackChunktool"]=self["webpackChunktool"]||[];o.forEach(n.bind(null,0)),o.push=n.bind(null,o.push.bind(o))}();var o=t.O(void 0,[504],(function(){return t(750)}));o=t.O(o)})();
//# sourceMappingURL=app.36f1205e.js.map